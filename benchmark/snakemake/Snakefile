
import pandas as pd
from pathlib import Path
from snakemake.utils import min_version

min_version("8.0.0")
conda: "../environments/snake_env.yaml"
configfile: "../configuration/config.yaml"
TEMPDIR = Path(config["TEMPDIR"])

# Grids
n_sample_augur = [0, 1000, 5000, 10000, 50000, 100000, 500000, 1000000]

rule all:
    input:
        expand("../results/augur_{n_sample}_py.csv", n_sample=n_sample_augur),
        "../results/augur_r.csv",
        # "../results/augur_compare.csv"


## AUGUR
rule augur_pertpy:
    output:
        "../results/augur_{n_sample}_py.csv",
    conda: "../environments/pertpy_env.yaml"
    benchmark:
        repeat("benchmarks/augur.{n_sample}.pertpy.benchmark.tsv", 3)
    threads: 16
    resources:
        mem_mb=32000
    script: "../scripts/augur.py"

rule augur_original:
    output:
        out_sim = "../results/augur_r.csv"
    conda: "augur_env"  # "../environments/augur_env.yaml"
    benchmark:
        "benchmarks/augur.original.benchmark.tsv"
    script: "../scripts/augur.R"

rule augur_compare:
    input:
        "../results/augur_0_py.csv",
        "../results/augur_r.csv"
    output:
        "../results/augur_compare.csv"
    log:
        notebook="logs/notebooks/processed_augur_compare.ipynb"
    conda: "../environments/pertpy_env.yaml"
    notebook: "../scripts/augur_compare.ipynb"

## MILO
# rule milo:
#     output:
#         "../results/milo.csv"
#     log:
#         notebook="logs/notebooks/processed_augur_compare.ipynb"
#     conda: "../environments/milo_env.yaml"
#     notebook: "../scripts/milo_benchmark.ipynb"

## MIXSCAPE
# rule mixscape:
#     output:
#         "../results/mixscape.csv"
#     log:
#         notebook="logs/notebooks/processed_mixscape.ipynb"
#     conda: "../environments/mixscape_env.yaml"
#     notebook: "../scripts/mixscape_compare.ipynb"

## SCCODA
# rule sccoda:
#     output:
#         "../results/sccoda.csv"
#     log:
#         notebook="logs/notebooks/processed_sccoda.ipynb"
#     conda: "../environments/sccoda_env.yaml"
#     notebook: "../scripts/sccoda_compare.ipynb"
